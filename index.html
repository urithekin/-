<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>× ×—×© ××™: ××•×œ×™××¤×•×¡ ×¤×¨×• - ××”×“×•×¨×ª ×”×‘×•×˜</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #0f172a; color: #f8fafc; font-family: 'Segoe UI', system-ui; text-align: center; margin: 0; }
        .top { background: linear-gradient(135deg, #b89130, #927425); padding: 15px; border-bottom: 3px solid #fff; color: #1e293b; position: sticky; top: 0; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; padding: 25px; max-width: 1000px; margin: auto; }
        .card { background: #fff; color: #1e293b; border: 3px solid #b89130; border-radius: 12px; padding: 10px; cursor: pointer; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.3); position: relative; }
        .card.off { opacity: 0.1; transform: scale(0.8) translateY(10px); filter: grayscale(1); }
        button, input, select { padding: 10px 15px; margin: 5px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; }
        .btn-confirm { background: #1e293b; color: #fff; border: 2px solid #fff; }
        .btn-bot { background: #7c3aed; color: white; }
        .btn-guess { background: #16a34a; color: white; }
        #chat-area { background: #1e293b; padding: 15px; border-radius: 10px; max-width: 600px; margin: 10px auto; display: none; }
        #end-screen { display:none; position:fixed; inset:0; background: rgba(0,0,0,0.95); z-index:2000; justify-content:center; align-items:center; flex-direction:column; }
        #my-secret-display { color: #fde047; font-size: 1.2em; margin: 10px; font-weight: bold; }
        .msg { margin: 5px; padding: 8px; border-radius: 5px; text-align: right; }
        .bot-msg { background: #334155; border-right: 4px solid #b89130; }
    </style>
</head>
<body>

<div id="end-screen">
    <h1 id="end-title" style="font-size: 5em; margin: 0;"></h1>
    <p id="end-sub" style="font-size: 2em;"></p>
    <button onclick="location.reload()" style="background:#b89130; color:white; padding:15px 40px; font-size:1.5em; margin-top:30px;">××©×—×§ ×—×“×©</button>
</div>

<div class="top">
    <div id="setup">
        <button class="btn-bot" onclick="startBotGame()">ğŸ¤– ××©×—×§ × ×’×“ ×‘×•×˜</button>
        <span style="margin: 0 15px;">××•</span>
        ×§×•×“ ×—×“×¨: <b id="myId" style="color:white;">...</b>
        <input type="text" id="joinId" placeholder="×§×•×“ ×™×¨×™×‘" style="width:80px">
        <button onclick="join()">×”×ª×—×‘×¨</button>
    </div>
    
    <div id="gameUI" style="display:none">
        ×‘×—×¨ ××ª ×”×“××•×ª ×©×œ×š: <select id="sel"></select>
        <button id="lockBtn" class="btn-confirm" onclick="lockSecret()">×× ×™ ×‘×•×—×¨ ×‘×–×”!</button>
        <button class="btn-guess" id="guessBtn" onclick="guess()" style="display:none;">×× ×™ ×™×•×“×¢ ××™ ×–×”!</button>
    </div>
</div>

<div id="status" style="margin:10px; color:#cbd5e1;">×‘×—×¨ ××¦×‘ ××©×—×§ ×›×“×™ ×œ×”×ª×—×™×œ</div>
<div id="my-secret-display"></div>

<div id="chat-area">
    <div id="chat-history" style="height: 100px; overflow-y: auto; margin-bottom: 10px; font-size: 0.9em;"></div>
    <input type="text" id="questionInput" placeholder="×©××œ ×©××œ×” (×œ××©×œ: ×”×× ×™×© ×œ×š × ×©×§?)" style="width: 70%;">
    <button onclick="askQuestion()">×©××œ</button>
</div>

<div class="grid" id="board"></div>

<script>
    // ×¨×©×™××ª ××œ×™× ×¢× ×ª×’×™×•×ª ×œ×–×™×”×•×™ ×¢"×™ ×”×‘×•×˜
    const gods = [
        {n:"×–××•×¡",i:"âš¡", t:["×–×›×¨","××œ","×‘×¨×§","×©××™×™×","××œ×š","×–×§×Ÿ"]},
        {n:"×”×¨×”",i:"ğŸ‘‘", t:["× ×§×‘×”","××œ×”","××œ×›×”","× ×™×©×•××™×Ÿ"]},
        {n:"×¤×•×¡×™×“×•×Ÿ",i:"ğŸ”±", t:["×–×›×¨","××œ","×™×","××™×","×§×œ×©×•×Ÿ","×¡×•×¡"]},
        {n:"××ª× ×”",i:"ğŸ¦‰", t:["× ×§×‘×”","××œ×”","×—×›××”","××œ×—××”","×§×¡×“×”","×™× ×©×•×£"]},
        {n:"××¨×¡",i:"âš”ï¸", t:["×–×›×¨","××œ","××œ×—××”","×—×¨×‘","× ×©×§"]},
        {n:"××¤×¨×•×“×™×˜×”",i:"ğŸ•Šï¸", t:["× ×§×‘×”","××œ×”","×™×•×¤×™","××”×‘×”","×™×•× ×”"]},
        {n:"××¤×•×œ×•",i:"â˜€ï¸", t:["×–×›×¨","××œ","×©××©","××•×–×™×§×”","× ×‘×•××”"]},
        {n:"××¨×˜××™×¡",i:"ğŸ¹", t:["× ×§×‘×”","××œ×”","×¦×™×“","×™×¨×—","×§×©×ª"]},
        {n:"×”××“×¡",i:"ğŸ’€", t:["×–×›×¨","××œ","×©××•×œ","××•×•×ª","×–×”×‘"]},
        {n:"×”×¤×™×¡×˜×•×¡",i:"ğŸ”¨", t:["×–×›×¨","××œ","××©","× ×¤×—×•×ª","×¤×˜×™×©"]},
        {n:"×”×¨××¡",i:"ğŸ‘Ÿ", t:["×–×›×¨","××œ","××”×™×¨×•×ª","×©×œ×™×—","× ×¢×œ×™×™×"]},
        {n:"×“×™×•× ×™×¡×•×¡",i:"ğŸ‡", t:["×–×›×¨","××œ","×™×™×Ÿ","××¡×™×‘×”"]},
        {n:"×“××˜×¨",i:"ğŸŒ¾", t:["× ×§×‘×”","××œ×”","××“××”","×—×§×œ××•×ª"]},
        {n:"×”×¡×˜×™×”",i:"ğŸ”¥", t:["× ×§×‘×”","××œ×”","×‘×™×ª","××©"]},
        {n:"×¤×¨×•××ª××•×¡",i:"ğŸ•¯ï¸", t:["×–×›×¨","×˜×™×˜××Ÿ","××©","××“×"]},
        {n:"×¤××Ÿ",i:"ğŸ", t:["×–×›×¨","××œ","×˜×‘×¢","×—×œ×™×œ","×¢×–"]},
        {n:"×¤×¨×¡××•×¡",i:"ğŸ›¡ï¸", t:["×–×›×¨","×’×™×‘×•×¨","×¨××©","××“×•×–×”"]},
        {n:"×”×§××˜×™",i:"ğŸŒ™", t:["× ×§×‘×”","××œ×”","×§×¡×","×œ×™×œ×”"]},
        {n:"× ×™×§×”",i:"ğŸ†", t:["× ×§×‘×”","××œ×”","× ×™×¦×—×•×Ÿ","×›× ×¤×™×™×"]},
        {n:"×”×œ×™×•×¡",i:"ğŸŒ…", t:["×–×›×¨","×˜×™×˜××Ÿ","×©××©","××¨×›×‘×”"]},
        {n:"××˜×œ×¡",i:"ğŸŒ", t:["×–×›×¨","×˜×™×˜××Ÿ","×¢×•×œ×","×›×“×•×¨"]},
        {n:"×§×¨×•× ×•×¡",i:"â³", t:["×–×›×¨","×˜×™×˜××Ÿ","×–××Ÿ","×—×¨××©"]},
        {n:"×¨×™××”",i:"ğŸ”ï¸", t:["× ×§×‘×”","×˜×™×˜×× ×™×ª","×××"]},
        {n:"×”×¨×§×•×œ×¡",i:"ğŸ¦", t:["×–×›×¨","×’×™×‘×•×¨","×›×•×—","××¨×™×”"]},
        {n:"××›×™×œ×¡",i:"ğŸ—¡ï¸", t:["×–×›×¨","×’×™×‘×•×¨","×¢×§×‘","××œ×—××”"]},
        {n:"××“×•×–×”",i:"ğŸ", t:["× ×§×‘×”","××¤×œ×¦×ª","× ×—×©×™×","×¢×™× ×™×™×"]},
        {n:"× ×¨×§×™×¡×•×¡",i:"ğŸŒ·", t:["×–×›×¨","×¤×¨×—","×™×•×¤×™"]},
        {n:"×¤× ×“×•×¨×”",i:"ğŸ“¦", t:["× ×§×‘×”","×ª×™×‘×”","×¡×§×¨× ×•×ª"]},
        {n:"××™×§×¨×•×¡",i:"ğŸª½", t:["×–×›×¨","×›× ×¤×™×™×","×©××©"]},
        {n:"××¨×•×¡",i:"ğŸ’˜", t:["×–×›×¨","××”×‘×”","×§×©×ª"]}
    ];

    let peer, conn, mySecret = "", enemySecret = "", isBot = false;
    let botOptions = [...gods];

    const playSound = (type) => {
        try {
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            if(type === 'click') { osc.frequency.setValueAtTime(150, ctx.currentTime); gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1); osc.start(); osc.stop(ctx.currentTime + 0.1); }
            else if(type === 'win') { [440, 554, 659].forEach((f, i) => { const o = ctx.createOscillator(); o.connect(gain); o.frequency.setValueAtTime(f, ctx.currentTime + i*0.1); o.start(ctx.currentTime + i*0.1); o.stop(ctx.currentTime + 0.5); }); }
        } catch(e) {}
    };

    const shortId = Math.floor(1000 + Math.random() * 9000).toString();
    peer = new Peer(shortId);
    peer.on('open', id => { document.getElementById('myId').innerText = id; });
    peer.on('connection', c => { conn = c; isBot = false; setup(); });

    function startBotGame() {
        isBot = true;
        enemySecret = gods[Math.floor(Math.random() * gods.length)].n;
        document.getElementById('setup').style.display = "none";
        document.getElementById('gameUI').style.display = "block";
        document.getElementById('status').innerText = "××©×—×§ × ×’×“ ×”×‘×•×˜! ×‘×—×¨ ××ª ×”×“××•×ª ×©×œ×š.";
        render();
    }

    function join() { conn = peer.connect(document.getElementById('joinId').value); isBot = false; setup(); }

    function setup() {
        conn.on('open', () => {
            playSound('win');
            document.getElementById('status').innerText = "××—×•×‘×¨! ×‘×—×¨ ×“××•×ª.";
            document.getElementById('setup').style.display = "none";
            document.getElementById('gameUI').style.display = "block";
            render();
        });
        conn.on('data', d => {
            if(d.type === 'secret') { enemySecret = d.value; document.getElementById('status').innerText = "×”×™×¨×™×‘ ××•×›×Ÿ!"; }
            if(d.type === 'gameOver') showEndScreen(false, d.yourGod);
        });
    }

    function render() {
        const b = document.getElementById('board'), s = document.getElementById('sel');
        b.innerHTML = ''; s.innerHTML = '<option value="">--×‘×—×¨--</option>';
        gods.sort((a,b)=>a.n.localeCompare(b.n)).forEach(g => {
            s.innerHTML += `<option value="${g.n}">${g.n}</option>`;
            const c = document.createElement('div');
            c.className = 'card';
            c.innerHTML = `<div style="font-size:35px">${g.i}</div><b>${g.n}</b>`;
            c.onclick = () => { playSound('click'); c.classList.toggle('off'); };
            b.appendChild(c);
        });
    }

    function lockSecret() {
        const v = document.getElementById('sel').value;
        if(!v) return;
        mySecret = v;
        document.getElementById('my-secret-display').innerText = "×”×¡×•×“ ×©×œ×š: " + v;
        document.getElementById('lockBtn').style.display = "none";
        document.getElementById('sel').disabled = true;
        document.getElementById('guessBtn').style.display = "inline-block";
        if(isBot) {
            document.getElementById('chat-area').style.display = "block";
            document.getElementById('status').innerText = "×ª×•×¨×š ×œ×©××•×œ ××ª ×”×‘×•×˜!";
        } else {
            conn.send({type: 'secret', value: v});
        }
        playSound('win');
    }

    // ×œ×•×’×™×§×ª ×”×‘×•×˜ - ××¢× ×” ×¢×œ ×©××œ×•×ª ×—×•×¤×©×™×•×ª
    function askQuestion() {
        const input = document.getElementById('questionInput');
        const q = input.value.trim();
        if(!q) return;

        addChatMessage("××ª×”: " + q);
        input.value = "";

        setTimeout(() => {
            const secretObj = gods.find(g => g.n === enemySecret);
            let answer = "×× ×™ ×œ× ×‘×˜×•×— ×œ××” ×”×ª×›×•×•× ×ª, × ×¡×” ×œ×©××•×œ ×¢×œ ××’×“×¨, × ×©×§ ××• ××œ×× ×˜.";
            
            // ×‘×“×™×§×ª ××™×œ×•×ª ××¤×ª×— ×‘×ª×’×™×•×ª
            const matchedTag = secretObj.t.find(tag => q.includes(tag));
            
            if(q.includes("×–×›×¨") || q.includes("×‘×Ÿ")) answer = secretObj.t.includes("×–×›×¨") ? "×›×Ÿ, ×× ×™ ×–×›×¨." : "×œ×, ×× ×™ × ×§×‘×”.";
            else if(q.includes("× ×§×‘×”") || q.includes("×‘×ª")) answer = secretObj.t.includes("× ×§×‘×”") ? "×›×Ÿ, ×× ×™ × ×§×‘×”." : "×œ×, ×× ×™ ×–×›×¨.";
            else if(matchedTag) answer = "×›×Ÿ!";
            else answer = "×œ×.";

            addChatMessage("×‘×•×˜: " + answer, true);
            botTurn();
        }, 600);
    }

    function botTurn() {
        setTimeout(() => {
            // ×”×‘×•×˜ "××¦××¦×" ××¤×©×¨×•×™×•×ª (×¡×™××•×œ×¦×™×”)
            if(Math.random() > 0.8) {
                const botGuess = gods[Math.floor(Math.random() * gods.length)].n;
                addChatMessage(`×‘×•×˜: ×”×× ××ª×” ${botGuess}?`, true);
                if(botGuess === mySecret) {
                    showEndScreen(false, botGuess);
                } else {
                    addChatMessage(`×‘×•×˜: ××•×£, ×˜×¢×™×ª×™...`);
                }
            } else {
                addChatMessage("×‘×•×˜: ××¢× ×™×™×Ÿ... ×ª×•×¨×š ×©×•×‘.", true);
            }
        }, 1000);
    }

    function addChatMessage(msg, isBotMsg = false) {
        const hist = document.getElementById('chat-history');
        const div = document.createElement('div');
        div.className = 'msg' + (isBotMsg ? ' bot-msg' : '');
        div.innerText = msg;
        hist.appendChild(div);
        hist.scrollTop = hist.scrollHeight;
    }

    function guess() {
        const a = prompt("××™ ×”×“××•×ª ×©×œ ×”×™×¨×™×‘?");
        if(!a) return;
        if(a.trim() === enemySecret) {
            playSound('win');
            if(!isBot) conn.send({type: 'gameOver', yourGod: enemySecret});
            showEndScreen(true);
        } else {
            alert("×˜×¢×•×ª! × ×¡×” ×©×•×‘ ×‘×ª×•×¨ ×”×‘×.");
            if(isBot) botTurn();
        }
    }

    function showEndScreen(isWin, god) {
        const screen = document.getElementById('end-screen');
        screen.style.display = "flex";
        if(isWin) {
            document.getElementById('end-title').innerText = "× ×™×¦×—×ª! ğŸ‰";
            document.getElementById('end-sub').innerText = "×”×‘×•×˜ ×œ× ×”×¦×œ×™×— ×œ×¢×¦×•×¨ ××•×ª×š!";
        } else {
            document.getElementById('end-title').innerText = "×”×¤×¡×“×ª! ğŸ’€";
            document.getElementById('end-sub').innerText = `×”×‘×•×˜ ×’×™×œ×” ×©××ª×” ${god}`;
        }
    }
</script>
</body>
</html>